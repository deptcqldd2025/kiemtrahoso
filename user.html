<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Nhân Sự v5.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    <style>
        .user-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 10px; border-left: 5px solid #198754; transition: 0.2s; }
        .user-card:hover { transform: translateY(-2px); }
        .user-card.blocked { border-left-color: #dc3545; background-color: #fff5f5; opacity: 0.8; }
        .badge-group-5 { background: #dc3545; color: white; }
        .badge-group-common { background: #0d6efd; color: white; }
        .badge-group-0 { background: #6c757d; color: white; }
    </style>
</head>
<body>

    <div id="app-header-placeholder"></div>

    <div id="mainContent" class="container pb-5" style="display:none">
        <div class="row g-2 mb-3">
            <div class="col-12">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
                    <input type="text" id="searchInput" class="form-control" placeholder="Tìm tên, email..." oninput="renderList()">
                </div>
            </div>
            <div class="col-12 text-muted small d-flex justify-content-between">
                <span>Tổng: <b id="totalUsers">0</b></span>
                <span>V5.0</span>
            </div>
        </div>
        <div id="userListContainer">
            <div class="text-center mt-5"><div class="spinner-border text-danger"></div><p class="mt-2 text-muted">Đang tải...</p></div>
        </div>
    </div>

    <div class="modal fade" id="editUserModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">Sửa User</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <input type="hidden" id="editKey">
        <div class="mb-3"><label class="fw-bold">Tên:</label><input type="text" id="editName" class="form-control"></div>
        <div class="mb-3"><label class="fw-bold">SĐT:</label><input type="text" id="editPhone" class="form-control"></div>
        <div class="mb-3"><label class="fw-bold">Nhóm:</label><select id="editGroup" class="form-select"><option value="5">Nhóm 5 (Admin)</option><option value="1">Nhóm 1</option><option value="2">Nhóm 2</option><option value="3">Nhóm 3</option><option value="4">Nhóm 4</option><option value="0">Nhóm 0 (Xem)</option></select></div>
    </div><div class="modal-footer"><button class="btn btn-primary" onclick="saveUser()">Lưu</button></div></div></div></div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="config.js"></script>
    <script src="layout.js"></script>

    <script>
        initAppLayout('Quản Lý Nhân Sự');
        
        let allUsers = {};

        initAuth((user, userData) => {
            // Check Perm
            if (user.email === ADMIN_EMAIL || (userData && userData.group == 5)) {
                document.getElementById('mainContent').style.display = 'block';
                loadData();
            } else {
                alert("Không có quyền truy cập!");
                window.location.href = "index.html";
            }
        });

        function loadData() {
            db.ref('app_users').on('value', snap => { allUsers = snap.val() || {}; renderList(); });
        }

        function renderList() {
            // ... (Copy logic renderList từ bản 4.5 vào đây) ...
            // Lưu ý đổi các class badge cho phù hợp với CSS mới
        }
        
        // ... (Copy saveUser, openEditModal, toggleBlock từ bản 4.5 vào đây) ...
        
        // Bạn copy nốt phần logic JS trong thẻ script của user.html v4.5 vào đây nhé.
    </script>
</body>
</html>
